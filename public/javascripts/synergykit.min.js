function SynergykitObject(){this.data={__v:0,_id:null,createdAt:(new Date).getTime(),updatedAt:(new Date).getTime()}}function Data(e,t){Data.super_.apply(this,arguments),this.synergykit=t,this.collection=Synergykit.urlify(e),this.endpoint="/data/"+Synergykit.urlify(e),this.query={}}function Files(e,t,n){Files.super_.apply(this,arguments),this.name=t,this.file=e,this.synergykit=n,this.endpoint="/files"}function Functions(e,t){Functions.super_.apply(this,arguments),this.synergykit=t,this.url=e,this.endpoint="/functions"}function Logs(e,t){Logs.super_.apply(this,arguments),this.synergykit=t,this.endpoint="/logs"}function Mailing(e,t){Mailing.super_.apply(this,arguments),this.synergykit=t,this.url=e,this.endpoint="/mailing"}function Notifications(e,t){Notifications.super_.apply(this,arguments),this.synergykit=t,this.userIds=e,this.endpoint="/users/notification"}function Platforms(e){Platforms.super_.apply(this,arguments),this.synergykit=e,this.endpoint="/users"}function Users(e){Users.super_.apply(this,arguments),this.synergykit=e,this.endpoint="/users",this.query={}}function Query(e,t){return this.query={},Synergykit.isString(e)?this.name=e:this.object=e,this.synergykit=t,this}var synergykitBasicApi="%s.api.synergykit.com",synergykitApiVersion="/v2.1",Synergykit={tenant:null,key:null,token:null,loggedUser:null,debug:!1,local:!1,strategy:"sockets",api:"",modules:{},batches:[]};Synergykit.Init=function(e,t,n){n=n||{},Synergykit.tenant=Synergykit.urlify(e),Synergykit.key=t,Synergykit.debug=n.debug||!1,Synergykit.api="https://"+synergykitBasicApi.replace("%s",Synergykit.tenant),Synergykit.socketApi="wss://"+synergykitBasicApi.replace("%s",Synergykit.tenant),Synergykit.token=null,Synergykit.batches=[],n.local&&(Synergykit.local=!0,Synergykit.api="http://localhost:5078",Synergykit.socketApi="ws://localhost:5078"),n.strategy&&(Synergykit.strategy=n.strategy)},Synergykit.Errors={NO_SUCCESS_CALLBACK:"No success callback was found. You have to specify it.",NO_ERROR_CALLBACK:"No error callback was found. You have to specify it.",NO_EMAIL:"Email was not specified.",NO_OLD_PASSWORD:"Old password was not specified.",NO_PASSWORD:"Password was not specified.",NO_ROLES:"Roles were not specified.",NO_ID:"ID was not specified.",NO_USER_ID:"User ID was not specified.",NO_USER_IDS:"No user ids were specified.",NO_PLATFORM_ID:"No id was specified.",NO_PLATFORM_USER_ID:"No user id was specified.",NO_PLATFORM_NAME:"Platform name was not specified.",NO_PLATFORM_REGISTRATION_ID:"Registration id was not specified.",NO_PATH:"Path of the file was not specified.",NO_FILE:"File was not specified.",NO_URL:"Url was not specified.",NO_SUBJECT:"Subject was not specified.",NO_SYNERGYKIT_OBJECT:"Synergykit object was not specified.",NO_AUTH_DATA:"No authData was specified.",NO_FACEBOOK_DATA:"No facebook data was specified.",NO_FACEBOOK_ID:"No facebook id was specified.",NO_FACEBOOK_ACCESS_TOKEN:"No facebook access token was specified.",NO_TWITTER_DATA:"No twitter data was speicfied.",NO_TWITTER_ID:"No twitter id was specified.",NO_TWITTER_SCREEN_NAME:"No twitter screen name was specified.",NO_TWITTER_CONSUMER_KEY:"No twitter consumer key was specified.",NO_TWITTER_CONSUMER_SECRET:"No twitter consumer secret was specified.",NO_TWITTER_AUTH_TOKEN:"No twitter auth token was specified.",NO_TWITTER_AUTH_TOKEN_SECRET:"No twitter auth token secret was specified.",NO_GOOGLE_DATA:"No google data was specified.",NO_GOOGLE_ID:"No google id was specified.",NO_ANONYMOUS_DATA:"No anonymous data was specified."},SynergykitObject.prototype.set=function(e,t){Synergykit.isObject(e)&&void 0===t?this.data=e:this.data[e]=t},SynergykitObject.prototype.get=function(e){if(void 0===e){var t={};for(var n in this.data)t[n]=this.data[n];return t}return this.data[e]},Data.super_=SynergykitObject,Data.prototype=Object.create(SynergykitObject.prototype,{constructor:{value:Data,enumarable:!1}}),Data.prototype.fetch=function(e){"sockets"==this.synergykit.strategy?this.synergykit.socketGet(this,null,e):this.synergykit.request({method:"GET",endpoint:this.endpoint+"/"+this.get("_id")},e,this)},Data.prototype.save=function(e){"sockets"==this.synergykit.strategy?this.get("_id")&&void 0!==this.get("__v")?this.synergykit.socketUpdate(this,e):this.synergykit.socketCreate(this,e):this.get("_id")&&void 0!==this.get("__v")?this.synergykit.request({method:"PUT",endpoint:this.endpoint+"/"+this.get("_id")},e,this):this.synergykit.request({method:"POST",endpoint:this.endpoint},e,this)},Data.prototype.destroy=function(e){"sockets"==this.synergykit.strategy?this.synergykit.socketDestroy(this,e):this.get("_id")?this.synergykit.request({method:"DELETE",endpoint:this.endpoint+"/"+this.get("_id")},e,this):this.synergykit.request({method:"DELETE",endpoint:this.endpoint},e,this)},Data.prototype.addAccess=function(e,t){e instanceof this.synergykit.modules.Users&&(e=e.get("_id")),this.synergykit.request({method:"POST",endpoint:this.endpoint+"/"+this.get("_id")+"/"+e},t,this)},Data.prototype.removeAccess=function(e,t){e instanceof this.synergykit.modules.Users&&(e=e.get("_id")),this.synergykit.request({method:"DELETE",endpoint:this.endpoint+"/"+this.get("_id")+"/"+e},t,this)},Data.prototype.on=function(e,t,n){var i={eventName:e};Synergykit.isFunction(t)?n=t:i.filter={name:t.name,query:t.query.$filter},this.synergykit.subscribe(i,this,n)},Data.prototype.speak=function(e,t){t||(t={}),this.synergykit.speak(e,t,this)},Data.prototype.off=function(e,t,n){var i={eventName:e};Synergykit.isFunction(t)?n=t:Synergykit.isObject(t)&&(i.filter=t),this.synergykit.unsubscribe(i,this)},Files.super_=SynergykitObject,Files.prototype=Object.create(SynergykitObject.prototype,{constructor:{value:Files,enumarable:!1}}),Files.prototype.upload=function(e){if(!this.file)throw Synergykit.Errors.NO_FILE;var t=new FormData;this.name&&t.append("name",this.name),t.append("file",this.file),this.synergykit.request({method:"POST",formData:t,endpoint:this.endpoint},e,this)},Files.prototype.fetch=function(e){this.synergykit.request({method:"GET",endpoint:this.endpoint+"/"+this.get("_id")},e,this)},Files.prototype.destroy=function(e){if(!this.get("_id"))throw Synergykit.Errors.NO_ID;this.synergykit.request({method:"DELETE",endpoint:this.endpoint+"/"+this.get("_id")},e,this)},Files.prototype.addAccess=function(e,t){e instanceof this.synergykit.modules.Users&&(e=e.get("_id")),this.synergykit.request({method:"POST",endpoint:this.endpoint+"/"+this.get("_id")+"/"+e},t,this)},Files.prototype.removeAccess=function(e,t){e instanceof this.synergykit.modules.Users&&(e=e.get("_id")),this.synergykit.request({method:"DELETE",endpoint:this.endpoint+"/"+this.get("_id")+"/"+e},t,this)},Functions.super_=SynergykitObject,Functions.prototype=Object.create(SynergykitObject.prototype,{constructor:{value:Functions,enumarable:!1}}),Functions.prototype.run=function(e){if(!this.url)throw Synergykit.Errors.NO_URL;this.synergykit.request({method:"POST",body:this.get(),endpoint:this.endpoint+"/"+this.url},e)},Logs.super_=SynergykitObject,Logs.prototype=Object.create(SynergykitObject.prototype,{constructor:{value:Logs,enumarable:!1}}),Mailing.super_=SynergykitObject,Mailing.prototype=Object.create(SynergykitObject.prototype,{constructor:{value:Mailing,enumarable:!1}}),Mailing.prototype.send=function(e){if(!this.url)throw Synergykit.Errors.NO_URL;if(!this.get("email"))throw Synergykit.Errors.NO_EMAIL;if(!this.get("subject"))throw Synergykit.Errors.NO_SUBJECT;this.synergykit.request({method:"POST",body:this.get(),endpoint:"/mail/"+this.url},e)},Notifications.super_=SynergykitObject,Notifications.prototype=Object.create(SynergykitObject.prototype,{constructor:{value:Notifications,enumarable:!1}}),Notifications.prototype.send=function(e){this.set("userIds",this.userIds),this.synergykit.request({method:"POST",body:this.get(),endpoint:this.endpoint},e)},Platforms.super_=SynergykitObject,Platforms.prototype=Object.create(SynergykitObject.prototype,{constructor:{value:Platforms,enumarable:!1}}),Platforms.prototype.save=function(e){if(!this.get("platformName"))throw Synergykit.Errors.NO_PLATFORM_NAME;if(!this.get("registrationId"))throw Synergykit.Errors.NO_PLATFORM_REGISTRATION_ID;this.get("_id")?this.synergykit.request({method:"PUT",endpoint:this.endpoint+"/me/platforms/"+this.get("_id")},e,this):this.synergykit.request({method:"POST",endpoint:this.endpoint+"/me/platforms"},e,this)},Platforms.prototype.fetch=function(e){this.get("_id")?this.synergykit.request({method:"GET",endpoint:this.endpoint+"/me/platforms/"+this.get("_id")},e,this):this.synergykit.request({method:"GET",endpoint:this.endpoint+"/me/platforms"},e,this)},Platforms.prototype.destroy=function(e){this.get("_id")?this.synergykit.request({method:"DELETE",endpoint:this.endpoint+"/me/platforms/"+this.get("_id")},e,this):this.synergykit.request({method:"DELETE",endpoint:this.endpoint+"/me/platforms"},e,this)},Users.super_=SynergykitObject,Users.prototype=Object.create(SynergykitObject.prototype,{constructor:{value:Users,enumarable:!1}}),Users.prototype.save=function(e){this.get("_id")&&void 0!==this.get("__v")?this.synergykit.request({method:"PUT",endpoint:this.endpoint+"/"+this.get("_id")},e,this):this.synergykit.request({method:"POST",endpoint:this.endpoint},e,this)},Users.prototype.fetch=function(e){this.synergykit.request({method:"GET",endpoint:this.endpoint+"/"+this.get("_id")},e,this)},Users.prototype.login=function(e){if(!this.get("email"))throw Synergykit.Errors.NO_EMAIL;if(!this.get("password"))throw Synergykit.Errors.NO_PASSWORD;this.synergykit.request({method:"POST",endpoint:this.endpoint+"/login"},e,this)};var facebook=function(e){if(!this.get("authData"))throw Errors.NO_AUTH_DATA;var t=this.get("authData");if(!t.facebook)throw Errors.NO_FACEBOOK_DATA;var n=t.facebook;if(!n.id)throw Errors.NO_FACEBOOK_ID;if(!n.accessToken)throw Errors.NO_FACEBOOK_ACCESS_TOKEN;this.synergykit.request({method:"POST",endpoint:this.endpoint},e,this)};Users.prototype.facebookLogin=facebook,Users.prototype.facebookRegistration=facebook;var twitter=function(e){if(!this.get("authData"))throw Errors.NO_AUTH_DATA;var t=this.get("authData");if(!t.twitter)throw Errors.NO_TWITTER_DATA;var n=t.twitter;if(!n.id)throw Errors.NO_TWITTER_ID;if(!n.screenName)throw Errors.NO_TWITTER_SCREEN_NAME;if(!n.consumerKey)throw Errors.NO_TWITTER_CONSUMER_KEY;if(!n.consumerSecret)throw Errors.NO_TWITTER_CONSUMER_SECRET;if(!n.authToken)throw Errors.NO_TWITTER_AUTH_TOKEN;if(!n.authTokenSecret)throw Errors.NO_TWITTER_AUTH_TOKEN_SECRET;this.synergykit.request({method:"POST",endpoint:this.endpoint},e,this)};Users.prototype.twitterLogin=twitter,Users.prototype.twitterRegistration=twitter;var google=function(e){if(!this.get("authData"))throw Errors.NO_AUTH_DATA;var t=this.get("authData");if(!t.google)throw Errors.NO_GOOGLE_DATA;var n=t.google;if(!n.id)throw Errors.NO_GOOGLE_ID;this.synergykit.request({method:"POST",endpoint:this.endpoint},e,this)};Users.prototype.googleLogin=google,Users.prototype.googleRegistration=google,Users.prototype.anonymousLogin=function(e){if(!this.get("authData"))throw Errors.NO_AUTH_DATA;var t=this.get("authData");if(!t.anonymous)throw Errors.NO_ANONYMOUS_DATA;this.synergykit.request({method:"POST",endpoint:this.endpoint},e,this)},Users.prototype.addRole=function(e,t){this.synergykit.request({method:"POST",body:{role:e},endpoint:this.endpoint+"/"+this.get("_id")+"/roles"},t,this)},Users.prototype.removeRole=function(e,t){this.synergykit.request({method:"DELETE",endpoint:this.endpoint+"/"+this.get("_id")+"/roles/"+e},t,this)},Users.prototype.resetPassword=function(e){this.synergykit.request({method:"POST",endpoint:this.endpoint+"/reset-password/"+this.get("_id")},e,this)},Users.prototype.changePassword=function(e){if(!this.get("old_password"))throw Synergykit.Errors.NO_OLD_PASSWORD;if(!this.get("password"))throw Synergykit.Errors.NO_PASSWORD;this.synergykit.request({method:"POST",endpoint:this.endpoint+"/change-password/"+this.get("_id")},e,this)},Users.prototype.destroy=function(e){this.get("_id")?this.synergykit.request({method:"DELETE",endpoint:this.endpoint+"/"+this.get("_id")},e,this):this.synergykit.request({method:"DELETE",endpoint:this.endpoint},e,this)},Query.prototype.where=function(){return this.query.$filter="",this},Query.prototype.select=function(e){return this.query.$select=Synergykit.isArray(e)?e.join(","):e,this},Query.prototype.inlineCount=function(){return this.query.$inlinecount=!0,this},Query.prototype.top=function(e){return this.query.$top=parseInt(e),this},Query.prototype.skip=function(e){return this.query.$skip=parseInt(e),this},Query.prototype.orderBy=function(e){return this.query.$orderby=e,this},Query.prototype.desc=function(){return this.query.$orderby+=" desc",this},Query.prototype.asc=function(){return this.query.$orderby+=" asc",this},Query.prototype.toString=function(){return this.query},Query.prototype.attribute=function(e){return this.query.$filter+="'"+e+"'",this},Query.prototype.and=function(){return this.query.$filter+=" and ",this},Query.prototype.or=function(){return this.query.$filter+=" or ",this},Query.prototype.isEqualTo=function(e){return this.query.$filter+=" eq "+Synergykit.checkParameter(e),this},Query.prototype.isNotEqualTo=function(e){return this.query.$filter+=" ne "+Synergykit.checkParameter(e),this},Query.prototype.isGreaterThan=function(e){return this.query.$filter+=" gt "+Synergykit.checkParameter(e),this},Query.prototype.isGreaterOrEqualThan=function(e){return this.query.$filter+=" ge "+Synergykit.checkParameter(e),this},Query.prototype.isLessThan=function(e){return this.query.$filter+=" lt "+Synergykit.checkParameter(e),this},Query.prototype.isLessOrEqualThan=function(e){return this.query.$filter+=" le "+Synergykit.checkParameter(e),this},Query.prototype.isInArray=function(e){return this.query.$filter+=" in "+Synergykit.checkParameter(e),this},Query.prototype.isNotInArray=function(e){return this.query.$filter+=" nin "+Synergykit.checkParameter(e),this},Query.prototype.substringOf=function(e,t){return this.query.$filter+="substringof('"+t+"', "+e+")",this},Query.prototype.startsWith=function(e,t){return this.query.$filter+="startswith("+e+", '"+t+"')",this},Query.prototype.endsWith=function(e,t){return this.query.$filter+="endswith("+e+", '"+t+"')",this},Query.prototype.find=function(e){if(!this.object)throw Synergykit.Errors.NO_SYNERGYKIT_OBJECT;if(this.object instanceof Synergykit.modules.Data){var t="";if(this.query){var n=0;for(var i in this.query)t+=0==n?"?":"&",t+=i+"="+this.query[i],n++}this.synergykit.socketGet(this.object,t,e)}else this.synergykit.request({method:"GET",query:this.query,endpoint:this.object.endpoint},e,this.object)},Synergykit.checkParameter=function(e){return Synergykit.isString(e)?"'"+e+"'":e},Synergykit.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},Synergykit.modules.Query=Query,Synergykit.modules.Data=Data,Synergykit.modules.Files=Files,Synergykit.modules.Functions=Functions,Synergykit.modules.Logs=Logs,Synergykit.modules.Mailing=Mailing,Synergykit.modules.Notifications=Notifications,Synergykit.modules.Platforms=Platforms,Synergykit.modules.Users=Users,Synergykit.rt={client:null,socket:null,connected:!1,connecting:!1,queue:[],listeners:{},attemps:0,maxAttemps:10,connect:function(e){Synergykit.rt.connected=!1;try{Synergykit.rt.client=new WebSocket(Synergykit.socketApi,"echo-protocol")}catch(t){e.synergykit.debug&&console.log(t.message),Synergykit.rt.reconnect(e)}},reconnect:function(e){Synergykit.rt.attemps<Synergykit.rt.maxAttemps&&(e.synergykit.debug&&console.log("Reconnecting"),setTimeout(function(){Synergykit.rt.connect(e)},1e3*Synergykit.rt.attemps),Synergykit.rt.attemps++)},unsubscribed:function(e){e.synergykit.debug&&e&&console.log("Unsubscribed from collection '"+e.collection+"', event '"+e.message)},err:function(e){e&&console.log("Error: "+e.message)},checkConnection:function(e){null!=Synergykit.rt.client||Synergykit.rt.connecting||(Synergykit.rt.connecting=!0,Synergykit.rt.listeners.unsubscribed=Synergykit.rt.unsubscribed,Synergykit.rt.listeners.err=Synergykit.rt.err,Synergykit.rt.connect(e),Synergykit.rt.client.onopen=function(){Synergykit.rt.attemps=0,Synergykit.rt.connected=!0,Synergykit.rt.connecting=!1,e.synergykit.debug&&console.log("Connected")},Synergykit.rt.client.onerror=function(t){e.synergykit.debug&&console.log("Connection Error: "+t.toString()),setTimeout(function(){Synergykit.rt.reconnect(e);for(var t in Synergykit.rt.queue)Synergykit.rt.queue[t]()},5e3)},Synergykit.rt.client.onclose=function(){e.synergykit.debug&&console.log("Disconnected"),setTimeout(function(){Synergykit.rt.reconnect(e);for(var t in Synergykit.rt.queue)Synergykit.rt.queue[t]()},5e3)},Synergykit.rt.client.onmessage=function(e){if(e&&e.data){try{e=JSON.parse(e.data)}catch(t){console.log(t.message)}Synergykit.rt.listeners[e.event]&&Synergykit.rt.listeners[e.event](e.data)}})},send:function(e){Synergykit.rt.connected&&1==Synergykit.rt.client.readyState?Synergykit.rt.client.send(JSON.stringify(e)):setTimeout(function(){Synergykit.rt.send(e)},1e3)},addListener:function(e){var t;if(e.object){if(e.filter&&e.filter.name&&e.filter.query){if(t=e.eventName+"_"+e.object.collection+"_"+e.filter.name,!Synergykit.rt.listeners[t]){Synergykit.rt.checkConnection(e);var n=function(){Synergykit.rt.send({event:"subscribe",data:{tenant:e.synergykit.tenant,key:e.synergykit.key,token:e.synergykit.token,filter:e.filter,eventName:e.eventName,collectionName:e.object.collection}})};n(),Synergykit.rt.queue.push(n),Synergykit.rt.listeners[t]=function(t){e&&e.object?(e.object.set(t),e.callback(e.object)):e.callback(t)},Synergykit.rt.listeners["subscribed_"+t]=function(){e.synergykit.debug&&console.log("Subscribed to collection '"+e.object.collection+"', event '"+e.eventName+"', filter '"+e.filter.name)}}}else if(t=e.eventName+"_"+e.object.collection,!Synergykit.rt.listeners[t]){Synergykit.rt.checkConnection(e);var n=function(){Synergykit.rt.send({event:"subscribe",data:{tenant:e.synergykit.tenant,key:e.synergykit.key,token:e.synergykit.token,eventName:e.eventName,collectionName:e.object.collection}})};n(),Synergykit.rt.queue.push(n),Synergykit.rt.listeners[t]=function(t){e&&e.object?(e.object.set(t),e.callback(e.object)):e.callback(t)},Synergykit.rt.listeners["subscribed_"+t]=function(){e.synergykit.debug&&console.log("Subscribed to collection '"+e.object.collection+"', event '"+e.eventName)}}}else if(t=e.eventName,!Synergykit.rt.listeners[t]){Synergykit.rt.checkConnection(e);var n=function(){Synergykit.rt.send({event:"subscribe",data:{tenant:e.synergykit.tenant,key:e.synergykit.key,token:e.synergykit.token,eventName:e.eventName}})};n(),Synergykit.rt.queue.push(n),Synergykit.rt.listeners[e.eventName]=function(t){e&&e.object?(e.object.set(t),e.callback(e.object)):e.callback(t)},Synergykit.rt.listeners["subscribed_"+t]=function(){e.synergykit.debug&&console.log("Subscribed to event '"+t)}}},removeListener:function(e){var t;if(e.object){if(e.filter){if(t=e.eventName+"_"+e.object.collection+"_"+e.filter.name,Synergykit.rt.listeners[t]){Synergykit.rt.checkConnection(e),delete Synergykit.rt.listeners[t];var n=function(){Synergykit.rt.send({event:"unsubscribe",data:{tenant:e.synergykit.tenant,key:e.synergykit.key,token:e.synergykit.token,filter:e.filter,eventName:e.eventName,collectionName:e.object.collection}})};n(),Synergykit.rt.queue.push(n),Synergykit.rt.listeners["unsubscribed_"+t]=function(){e.synergykit.debug&&console.log("Unsubscribed from collection '"+e.object.collection+"', event '"+e.eventName+"', filter '"+e.filter.name)}}}else if(t=e.eventName+"_"+e.object.collection,Synergykit.rt.listeners[t]){Synergykit.rt.checkConnection(e),delete Synergykit.rt.listeners[t];var n=function(){Synergykit.rt.send({event:"unsubscribe",data:{tenant:e.synergykit.tenant,key:e.synergykit.key,token:e.synergykit.token,eventName:e.eventName,collectionName:e.object.collection}})};n(),Synergykit.rt.queue.push(n),Synergykit.rt.listeners["unsubscribed_"+t]=function(){e.synergykit.debug&&console.log("Unsubscribed from collection '"+e.object.collection+"', event '"+e.eventName)}}}else if(t=e.eventName,Synergykit.rt.listeners[t]){Synergykit.rt.checkConnection(e),delete Synergykit.rt.listeners[t];var n=function(){Synergykit.rt.send({event:"unsubscribe",data:{tenant:e.synergykit.tenant,key:e.synergykit.key,token:e.synergykit.token,eventName:e.eventName}})};n(),Synergykit.rt.queue.push(n),Synergykit.rt.listeners["unsubscribed_"+t]=function(){e.synergykit.debug&&console.log("Unsubscribed from event '"+e.eventName)}}},speak:function(e){Synergykit.rt.checkConnection(e);var t=function(){Synergykit.rt.send({event:"speak",data:{tenant:e.synergykit.tenant,token:e.synergykit.token,speakName:e.speakName,data:e.data}})};t(),Synergykit.rt.queue.push(t)},successCallback:function(e,t){var n;if(e&&e.object)if(Synergykit.isArray(t)){response=[];for(var i in t){var r=null;e.object instanceof Synergykit.modules.Data&&(r=Synergykit.Data(e.object.collection)),r.set(t[i]),response.push(r)}n=response}else e.object.set(t),n=e.object;else n=t;"function"==typeof e.callback?e.callback(null,n):e.callback&&"function"==typeof e.callback.success&&e.callback.success(n,200)},errorCallback:function(e,t){var n;e&&e.object?(e.object.set(t),n=e.object):n=t,"function"==typeof e.callback?e.callback(t):e.callback&&"function"==typeof e.callback.error&&e.callback.error(n,400)},get:function(e){Synergykit.rt.checkConnection(e),Synergykit._start=(new Date).getTime(),e.synergykit.debug&&console.log("calling: GET","/data/"+e.object.collection);var t=(Math.random()*(new Date).getTime()).toString(36).substring(2,10),n=function(){Synergykit.rt.send({event:"get",data:{tenant:e.synergykit.tenant,token:e.synergykit.token,key:e.synergykit.key,collectionName:e.object.collection,hash:t,id:e.object.get("_id"),query:e.query}})};n(),Synergykit.rt.listeners.got=function(n){n.hash==t&&(e.synergykit.debug&&(Synergykit._end=(new Date).getTime(),console.log("Success (time: "+Synergykit.calcTimeDiff()+"): GET","/data/"+e.object.collection)),Synergykit.rt.successCallback(e,n.data))},Synergykit.rt.listeners.err=function(n){n.hash==t&&Synergykit.rt.errorCallback(e,n.data)}},create:function(e){Synergykit.rt.checkConnection(e),Synergykit._start=(new Date).getTime(),e.synergykit.debug&&console.log("calling: POST","/data/"+e.object.collection);var t=(Math.random()*(new Date).getTime()).toString(36).substring(2,10),n=function(){Synergykit.rt.send({event:"create",data:{tenant:e.synergykit.tenant,token:e.synergykit.token,key:e.synergykit.key,hash:t,collectionName:e.object.collection,data:e.object.get()}})};n(),Synergykit.rt.listeners.created=function(n){n.hash==t&&(e.synergykit.debug&&(Synergykit._end=(new Date).getTime(),console.log("Success (time: "+Synergykit.calcTimeDiff()+"): POST","/data/"+e.object.collection)),Synergykit.rt.successCallback(e,n.data))},Synergykit.rt.listeners.err=function(n){n.hash==t&&Synergykit.rt.errorCallback(e,n.data)}},update:function(e){Synergykit.rt.checkConnection(e),Synergykit._start=(new Date).getTime(),e.synergykit.debug&&console.log("calling: PUT","/data/"+e.object.collection);var t=(Math.random()*(new Date).getTime()).toString(36).substring(2,10),n=function(){Synergykit.rt.send({event:"update",data:{tenant:e.synergykit.tenant,token:e.synergykit.token,key:e.synergykit.key,hash:t,collectionName:e.object.collection,id:e.object.get("_id"),data:e.object.get()}})};n(),Synergykit.rt.listeners.updated=function(n){n.hash==t&&(e.synergykit.debug&&(Synergykit._end=(new Date).getTime(),console.log("Success (time: "+Synergykit.calcTimeDiff()+"): PUT","/data/"+e.object.collection)),Synergykit.rt.successCallback(e,n.data))},Synergykit.rt.listeners.err=function(n){n.hash==t&&Synergykit.rt.errorCallback(e,n.data)}},destroy:function(e){Synergykit.rt.checkConnection(e),Synergykit._start=(new Date).getTime(),e.synergykit.debug&&console.log("calling: DELETE","/data/"+e.object.collection);var t=(Math.random()*(new Date).getTime()).toString(36).substring(2,10),n={tenant:e.synergykit.tenant,token:e.synergykit.token,key:e.synergykit.key,hash:t,collectionName:e.object.collection};e.object.get("_id")&&(n.id=e.object.get("_id"));var i=function(){Synergykit.rt.send({event:"delete",data:n})};i(),Synergykit.rt.listeners.deleted=function(n){n.hash==t&&(e.synergykit.debug&&(Synergykit._end=(new Date).getTime(),console.log("Success (time: "+Synergykit.calcTimeDiff()+"): DELETE","/data/"+e.object.collection)),Synergykit.rt.successCallback(e,n.data))},Synergykit.rt.listeners.err=function(n){n.hash==t&&Synergykit.rt.errorCallback(e,n.data)}}},Synergykit.request=function(e,t,n){if(void 0==t)Synergykit.batches.push({options:e,object:n});else{var i=e.method||"GET",r=e.endpoint||"/",s={};n&&n instanceof SynergykitObject&&(s=n.data),e.body&&(s=e.body);var o=e.query||{},y="";if(e.query){var a=0;for(var c in o)y+=0==a?"?":"&",y+=c+"="+o[c],a++}var g=Synergykit.api+synergykitApiVersion+r;Synergykit.debug&&console.log("calling: "+i+" "+g+y),Synergykit._start=(new Date).getTime();var u=Synergykit.createCORSRequest(i,g+y);e.formData||u.setRequestHeader("Content-Type","application/json"),Synergykit.token&&u.setRequestHeader("SessionToken",Synergykit.token),u.setRequestHeader("Authorization","Basic "+Synergykit.Base64.encode(Synergykit.tenant+":"+Synergykit.key)),u.onload=function(){try{var e=JSON.parse(u.responseText);if(Synergykit._end=(new Date).getTime(),u.status>=200&&u.status<400)if(Synergykit.debug&&console.log("Success (time: "+Synergykit.calcTimeDiff()+"): "+i+" "+g+y),n instanceof SynergykitObject){var r=null;if(e)if(Synergykit.isArray(e))if(e.length>0){r=[];for(var s in e){var o=null;n instanceof Synergykit.modules.Data?o=Synergykit.Data(n.collection):n instanceof Synergykit.modules.Files?o=Synergykit.modules.File(n.path):n instanceof Synergykit.modules.Functions?o=Synergykit.CloudCode(n.url):n instanceof Synergykit.modules.Logs||(n instanceof Synergykit.modules.Mailing?o=Synergykit.Mail(n.url):n instanceof Synergykit.modules.Platforms?o=Synergykit.Platform(n.user_id):n instanceof Synergykit.modules.Users&&(o=Synergykit.User())),o.set(e[s]),r.push(o)}}else r=e;else n instanceof Synergykit.modules.Users&&e.sessionToken&&(Synergykit.token=e.sessionToken,n.synergykit=Synergykit),Synergykit.isNumber(e)&&(e={count:e}),n.set(e),n instanceof Synergykit.modules.Users&&(Synergykit.loggedUser=n),r=n;try{Synergykit.callback(t,r,u.status)}catch(a){console.error(a.stack),Synergykit.errorCallback&&Synergykit.errorCallback({status:"error",code:"SKIT01-001",message:a.message})}}else try{Synergykit.callback(t,e,u.status)}catch(a){console.error(a.stack),Synergykit.errorCallback&&Synergykit.errorCallback({status:"error",code:"SKIT01-001",message:a.message})}else{err=!0;var c=e&&e.code?e.code:"SKIT01-001",k=e&&e.message?e.message:"";Synergykit.debug&&console.log("Error ("+u.status+")("+c+"): "+k);try{Synergykit.callback(t,e,u.status)}catch(a){console.error(a.stack),Synergykit.errorCallback&&Synergykit.errorCallback({status:"error",code:"SKIT01-001",message:a.message})}}}catch(a){console.error(a.stack)}},u.onerror=function(){},u.send(e.formData?e.formData:JSON.stringify(s))}},Synergykit.runBatch=function(e){var t="POST",n="/batch",i=Synergykit.api+synergykitApiVersion+n;Synergykit.debug&&console.log("calling: "+t+" "+i),Synergykit._start=(new Date).getTime();var r=Synergykit.createCORSRequest(t,i);r.setRequestHeader("Content-Type","application/json"),Synergykit.token&&r.setRequestHeader("SessionToken",Synergykit.token),r.setRequestHeader("Authorization","Basic "+Synergykit.Base64.encode(Synergykit.tenant+":"+Synergykit.key)),r.onload=function(){try{var t=JSON.parse(r.responseText);if(Synergykit._end=(new Date).getTime(),r.status>=200&&r.status<400){Synergykit.debug&&console.log("Success (time: "+Synergykit.calcTimeDiff()+"): POST "+i);var n=[];for(var s in t){var o=t[s],y=null,a=o.body;if(200==o.statusCode){if(Synergykit.batches[o.id]&&Synergykit.batches[o.id].object instanceof SynergykitObject){var c=Synergykit.batches[o.id].object;if(a)if(Synergykit.isArray(a))if(a.length>0){y=[];for(var g in a){var u=null;c instanceof Synergykit.modules.Data?u=Synergykit.Data(c.collection):c instanceof Synergykit.modules.Files?u=Synergykit.modules.File(c.path):c instanceof Synergykit.modules.Functions?u=Synergykit.CloudCode(c.url):c instanceof Synergykit.modules.Logs||(c instanceof Synergykit.modules.Mailing?u=Synergykit.Mail(c.url):c instanceof Synergykit.modules.Platforms?u=Synergykit.Platform(c.user_id):c instanceof Synergykit.modules.Users&&(u=Synergykit.User())),u.set(a[g]),y.push(u)}}else y=a;else c instanceof Synergykit.modules.Users&&a.sessionToken&&(Synergykit.token=a.sessionToken,c.synergykit=Synergykit),Synergykit.isNumber(a)&&(a={count:a}),c.set(a),c instanceof Synergykit.modules.Users&&(Synergykit.loggedUser=c),y=c;n.push(y)}}else n.push({status:o.status,code:o.code,message:o.message})}Synergykit.batches=[];try{Synergykit.callback(e,n,r.status)}catch(k){console.error(k.stack),Synergykit.errorCallback&&Synergykit.errorCallback({status:"error",code:"SKIT01-001",message:k.message})}}else{Synergykit.batches=[],err=!0;var l=o&&o.code?o.code:"SKIT01-001",d=o&&o.message?o.message:"";Synergykit.debug&&console.log("Error ("+r.status+")("+l+"): "+d);try{Synergykit.callback(e,o,r.status)}catch(k){console.error(k.stack),Synergykit.errorCallback&&Synergykit.errorCallback({status:"error",code:"SKIT01-001",message:k.message})}}}catch(k){console.error(k.stack)}},r.onerror=function(){};var s=[];for(var o in Synergykit.batches){var y=Synergykit.batches[o],a="";if(y.options.query){var c=y.options.query||{},g=0;for(var u in c)a+=0==g?"?":"&",a+=u+"="+c[u],g++}s.push({id:parseInt(o),method:y.options.method,endpoint:y.options.endpoint+a,body:y.options.body?y.options.body:y.object.get()})}r.send(JSON.stringify(s))},Synergykit.callback=function(e,t,n){200==n?"function"==typeof e?e(null,t,n):e&&"function"==typeof e.success&&e.success(t,n):"function"==typeof e?e(t,null,n):e&&"function"==typeof e.error&&e.error(t,n)},Synergykit.createCORSRequest=function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t,!0)):n=null,n},Synergykit.Data=function(e){var t=new Synergykit.modules.Data(e,Synergykit);return t},Synergykit.User=function(){var e=new Synergykit.modules.Users(Synergykit);return e},Synergykit.Notification=function(e){var t=[];if(Synergykit.isString(e))t.push(e);else if(e instanceof SynergykitObject&&e.get("_id"))t.push(e.get("_id"));else if(Synergykit.isArray(e))for(var n in e){var i=e[n];i instanceof SynergykitObject&&i.get("_id")?t.push(i.get("_id")):Synergykit.isString(i)&&t.push(i)}if(t.length>0){var r=new Synergykit.modules.Notifications(t,Synergykit);return r}throw Synergykit.Errors.NO_USER_IDS},Synergykit.Platform=function(){var e=new Synergykit.modules.Platforms(Synergykit);return e},Synergykit.CloudCode=function(e){var t=new Synergykit.modules.Functions(e,Synergykit);return t},Synergykit.Mail=function(e){var t=new Synergykit.modules.Mailing(e,Synergykit);return t},Synergykit.File=function(e,t){var n=new Synergykit.modules.Files(e,t,Synergykit);return n},Synergykit.Query=function(e){var t=new Synergykit.modules.Query(e,Synergykit);return t},Synergykit.on=function(e,t){var n=function(){Synergykit.rt.addListener({eventName:e,synergykit:Synergykit,callback:t})};if(Synergykit.token)n();else{var i=Synergykit.User();i.set("authData",{anonymous:{}}),i.anonymousLogin({success:n})}},Synergykit.off=function(e){var t=function(){Synergykit.rt.removeListener({eventName:e,synergykit:Synergykit,callback:callback})};if(Synergykit.token)t();else{var n=Synergykit.User();n.set("authData",{anonymous:{}}),n.anonymousLogin({success:t})}},Synergykit.socketGet=function(e,t,n){var i=function(){Synergykit.rt.get({synergykit:Synergykit,object:e,query:t,callback:n})};if(Synergykit.token)i();else{var r=Synergykit.User();r.set("authData",{anonymous:{}}),r.anonymousLogin({success:i})}},Synergykit.socketCreate=function(e,t){var n=function(){Synergykit.rt.create({synergykit:Synergykit,object:e,callback:t})
};if(Synergykit.token)n();else{var i=Synergykit.User();i.set("authData",{anonymous:{}}),i.anonymousLogin({success:n})}},Synergykit.socketUpdate=function(e,t){var n=function(){Synergykit.rt.update({synergykit:Synergykit,object:e,callback:t})};if(Synergykit.token)n();else{var i=Synergykit.User();i.set("authData",{anonymous:{}}),i.anonymousLogin({success:n})}},Synergykit.socketDestroy=function(e,t){var n=function(){Synergykit.rt.destroy({synergykit:Synergykit,object:e,callback:t})};if(Synergykit.token)n();else{var i=Synergykit.User();i.set("authData",{anonymous:{}}),i.anonymousLogin({success:n})}},Synergykit.subscribe=function(e,t,n){var i=function(){Synergykit.rt.addListener({synergykit:Synergykit,eventName:e.eventName,filter:e.filter,object:t,callback:n})};if(Synergykit.token)i();else{var r=Synergykit.User();r.set("authData",{anonymous:{}}),r.anonymousLogin({success:i})}},Synergykit.unsubscribe=function(e,t){var n=function(){Synergykit.rt.removeListener({eventName:e.eventName,filter:e.filter,synergykit:Synergykit,object:t})};if(Synergykit.token)n();else{var i=Synergykit.User();i.set("authData",{anonymous:{}}),i.anonymousLogin({success:n})}},Synergykit.speak=function(e,t){var n=function(){Synergykit.rt.speak({synergykit:Synergykit,speakName:e,data:t})};if(Synergykit.token)n();else{var i=Synergykit.User();i.set("authData",{anonymous:{}}),i.anonymousLogin({success:n})}},Synergykit.calcTimeDiff=function(){var e=Synergykit._end-Synergykit._start;return(e/1e3).toFixed(4)},Synergykit.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},Synergykit.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},Synergykit.isFunction=function(e){return"function"==typeof e||!1},Synergykit.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},Synergykit.urlify=function(e){return e.replace(/_/g,"-").replace(/ /g,"-").replace(/:/g,"-").replace(/\\/g,"-").replace(/\//g,"-").replace(/[^a-zA-Z0-9\-]+/g,"").replace(/-{2,}/g,"-").toLowerCase()},Synergykit.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,i,r,s,o,y,a="",c=0;for(e=Synergykit.Base64._utf8_encode(e);c<e.length;)t=e.charCodeAt(c++),n=e.charCodeAt(c++),i=e.charCodeAt(c++),r=t>>2,s=(3&t)<<4|n>>4,o=(15&n)<<2|i>>6,y=63&i,isNaN(n)?o=y=64:isNaN(i)&&(y=64),a=a+Synergykit.Base64._keyStr.charAt(r)+Synergykit.Base64._keyStr.charAt(s)+Synergykit.Base64._keyStr.charAt(o)+Synergykit.Base64._keyStr.charAt(y);return a},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}};